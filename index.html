<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üöì –°–∏—Å—Ç–µ–º–∞ –ì–ò–ë–î–î</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>üöì –°–∏—Å—Ç–µ–º–∞ –ì–ò–ë–î–î</h1>
            <nav class="main-nav">
                <button onclick="showSection('main')">–ì–ª–∞–≤–Ω–∞—è</button>
                <button onclick="showSection('drivers')">–í–æ–¥–∏—Ç–µ–ª–∏</button>
                <button onclick="showSection('vehicles')">–ê–≤—Ç–æ–º–æ–±–∏–ª–∏</button>
                <button onclick="showSection('violations')">–ù–∞—Ä—É—à–µ–Ω–∏—è</button>
                <button onclick="showSection('search')">–ü–æ–∏—Å–∫</button>
                <button onclick="showSection('statistics')">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</button>
                <button onclick="showSection('users')">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</button>
                <span style="flex:1"></span>
                <div id="authUserBadge" class="user-badge" style="display:none"></div>
                <button id="loginBtn" onclick="showSection('auth')">–í–æ–π—Ç–∏</button>
                <button id="logoutBtn" style="display:none" onclick="logout()">–í—ã–π—Ç–∏</button>
            </nav>
        </header>

        <main>
            <!-- –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ -->
            <section id="main" class="section active">
                <h2>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —Å–∏—Å—Ç–µ–º—É –ì–ò–ë–î–î</h2>
                <div class="dashboard">
                    <div class="stats-grid">
                        <div class="stat-card" onclick="showSection('drivers')">
                            <h3>üë§ –í–æ–¥–∏—Ç–µ–ª–∏</h3>
                            <p id="drivers-count">0</p>
                        </div>
                        <div class="stat-card" onclick="showSection('vehicles')">
                            <h3>üöó –ê–≤—Ç–æ–º–æ–±–∏–ª–∏</h3>
                            <p id="vehicles-count">0</p>
                        </div>
                        <div class="stat-card" onclick="showSection('violations')">
                            <h3>üö® –ù–∞—Ä—É—à–µ–Ω–∏—è</h3>
                            <p id="violations-count">0</p>
                        </div>
                        <div class="stat-card" onclick="showSection('statistics')">
                            <h3>üí∞ –®—Ç—Ä–∞—Ñ—ã</h3>
                            <p id="fines-total">0 —Ä—É–±.</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è -->
            <section id="auth" class="section">
                <h2>–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</h2>
                <div class="form-card">
                    <h3>–í—Ö–æ–¥</h3>
                    <form id="loginForm">
                        <input type="email" id="loginEmail" placeholder="Email" required>
                        <input type="password" id="loginPassword" placeholder="–ü–∞—Ä–æ–ª—å" required>
                        <button type="submit">–í–æ–π—Ç–∏</button>
                    </form>
                </div>
                <div class="form-card">
                    <h3>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h3>
                    <form id="registerForm">
                        <input type="text" id="registerName" placeholder="–ò–º—è (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)">
                        <input type="email" id="registerEmail" placeholder="Email" required>
                        <input type="password" id="registerPassword" placeholder="–ü–∞—Ä–æ–ª—å" required>
                        <button type="submit">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
                    </form>
                </div>
            </section>

            <!-- –í–æ–¥–∏—Ç–µ–ª–∏ -->
            <section id="drivers" class="section">
                <h2>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–æ–¥–∏—Ç–µ–ª—è–º–∏</h2>
                
                <div class="form-card">
                    <h3>–î–æ–±–∞–≤–∏—Ç—å –≤–æ–¥–∏—Ç–µ–ª—è</h3>
                    <form id="addDriverForm">
                        <input type="text" id="driverName" placeholder="–§–ò–û" required>
                        <input type="text" id="driverLicense" placeholder="–ù–æ–º–µ—Ä –ø—Ä–∞–≤" required>
                        <input type="text" id="driverAddress" placeholder="–ê–¥—Ä–µ—Å">
                        <input type="text" id="driverPhone" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω">
                        <button type="submit">–î–æ–±–∞–≤–∏—Ç—å –≤–æ–¥–∏—Ç–µ–ª—è</button>
                    </form>
                </div>

                <div class="table-card">
                    <div style="display: flex; gap: .5rem; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <h3 style="margin: 0;">–°–ø–∏—Å–æ–∫ –≤–æ–¥–∏—Ç–µ–ª–µ–π</h3>
                        <div style="display:flex; gap:.5rem;">
                            <button id="sortDriversBtn" onclick="sortDrivers()" style="background: #6c757d; padding: 0.5rem 1rem;">üî§ –°–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ –∞–ª—Ñ–∞–≤–∏—Ç—É</button>
                            <button onclick="exportData('drivers','docx')" title="DOCX" style="background:#596273; padding:.5rem 1rem;">DOCX</button>
                        </div>
                    </div>
                    <div id="driversList"></div>
                </div>
            </section>

            <!-- –ê–≤—Ç–æ–º–æ–±–∏–ª–∏ -->
            <section id="vehicles" class="section">
                <h2>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–≤—Ç–æ–º–æ–±–∏–ª—è–º–∏</h2>
                
                <div class="form-card">
                    <h3>–î–æ–±–∞–≤–∏—Ç—å –∞–≤—Ç–æ–º–æ–±–∏–ª—å</h3>
                    <form id="addVehicleForm">
                        <input type="text" id="vehiclePlate" placeholder="–ì–æ—Å–Ω–æ–º–µ—Ä" required>
                        <input type="text" id="vehicleBrand" placeholder="–ú–∞—Ä–∫–∞" required>
                        <input type="text" id="vehicleModel" placeholder="–ú–æ–¥–µ–ª—å" required>
                        <input type="number" id="vehicleYear" placeholder="–ì–æ–¥ –≤—ã–ø—É—Å–∫–∞">
                        <input type="number" id="vehicleOwnerId" placeholder="ID –≤–ª–∞–¥–µ–ª—å—Ü–∞" required>
                        <button type="submit">–î–æ–±–∞–≤–∏—Ç—å –∞–≤—Ç–æ–º–æ–±–∏–ª—å</button>
                    </form>
                </div>

                <div class="table-card">
                    <div style="display: flex; gap:.5rem; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <h3 style="margin: 0;">–°–ø–∏—Å–æ–∫ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π</h3>
                        <div style="display:flex; gap:.5rem;">
                            <button id="sortVehiclesBtn" onclick="sortVehicles()" style="background: #6c757d; padding: 0.5rem 1rem;">üî§ –°–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ –∞–ª—Ñ–∞–≤–∏—Ç—É</button>
                            <button onclick="exportData('vehicles','docx')" style="background:#596273; padding:.5rem 1rem;">DOCX</button>
                        </div>
                    </div>
                    <div id="vehiclesList"></div>
                </div>
            </section>

            <!-- –ù–∞—Ä—É—à–µ–Ω–∏—è -->
            <section id="violations" class="section">
                <h2>–£—á–µ—Ç –Ω–∞—Ä—É—à–µ–Ω–∏–π</h2>
                
                <div class="form-card">
                    <h3>–î–æ–±–∞–≤–∏—Ç—å –Ω–∞—Ä—É—à–µ–Ω–∏–µ</h3>
                    <form id="addViolationForm">
                        <input type="number" id="violationDriverId" placeholder="ID –≤–æ–¥–∏—Ç–µ–ª—è" required>
                        <input type="number" id="violationVehicleId" placeholder="ID –∞–≤—Ç–æ–º–æ–±–∏–ª—è" required>
                        <input type="text" id="violationType" placeholder="–¢–∏–ø –Ω–∞—Ä—É—à–µ–Ω–∏—è" required>
                        <input type="number" id="violationFine" placeholder="–°—É–º–º–∞ —à—Ç—Ä–∞—Ñ–∞" step="0.01" required>
                        <button type="submit">–î–æ–±–∞–≤–∏—Ç—å –Ω–∞—Ä—É—à–µ–Ω–∏–µ</button>
                    </form>
                </div>

                <div class="table-card">
                    <div style="display: flex; gap:.5rem; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <h3 style="margin: 0;">–°–ø–∏—Å–æ–∫ –Ω–∞—Ä—É—à–µ–Ω–∏–π</h3>
                        <div style="display:flex; gap:.5rem;">
                            <button id="sortViolationsBtn" onclick="sortViolations()" style="background: #6c757d; padding: 0.5rem 1rem;">üî§ –°–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ –∞–ª—Ñ–∞–≤–∏—Ç—É</button>
                            <button onclick="exportData('violations','docx')" style="background:#596273; padding:.5rem 1rem;">DOCX</button>
                        </div>
                    </div>
                    <div id="violationsList"></div>
                </div>
            </section>

            <!-- –ü–æ–∏—Å–∫ -->
            <section id="search" class="section">
                <h2>–ü–æ–∏—Å–∫ –≤–æ–¥–∏—Ç–µ–ª–µ–π</h2>
                
                <div class="form-card">
                    <h3>–ü–æ–∏—Å–∫</h3>
                    <form id="searchForm">
                        <select id="searchType">
                            <option value="name">–ü–æ –§–ò–û</option>
                            <option value="license">–ü–æ –Ω–æ–º–µ—Ä—É –ø—Ä–∞–≤</option>
                        </select>
                        <input type="text" id="searchValue" placeholder="–í–≤–µ–¥–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è –ø–æ–∏—Å–∫–∞" required>
                        <button type="submit">üîç –ù–∞–π—Ç–∏</button>
                    </form>
                </div>

                <div class="table-card">
                    <div style="display:flex; justify-content: space-between; align-items:center; margin-bottom:1rem;">
                        <h3 style="margin:0;">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞</h3>
                        <div style="display:flex; gap:.5rem;">
                            <button onclick="exportData('search','docx')" style="background:#596273; padding:.5rem 1rem;">DOCX</button>
                        </div>
                    </div>
                    <div id="searchResults"></div>
                </div>
            </section>

            <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
            <section id="statistics" class="section">
                <h2>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –æ—Ç—á–µ—Ç—ã</h2>
                
                <div class="stats-grid">
                    <div class="stat-card large">
                        <h3>üìä –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
                        <div id="generalStats"></div>
                    </div>
                    
                    <div class="stat-card large">
                        <h3>üö® –ü–æ—Å–ª–µ–¥–Ω–∏–µ –Ω–∞—Ä—É—à–µ–Ω–∏—è</h3>
                        <div id="recentViolations"></div>
                    </div>
                </div>
            </section>

            <!-- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ -->
            <section id="users" class="section">
                <h2>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</h2>
                <div class="table-card">
                    <h3>–°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h3>
                    <div id="usersList"></div>
                </div>
            </section>
        </main>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
    <!-- –ú–æ–¥–∞–ª–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è -->
    <div id="profileModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>–ü—Ä–æ—Ñ–∏–ª—å</h3>
                <span class="close" onclick="closeModal('profileModal')">&times;</span>
            </div>
            <div class="modal-body">
                <form id="profileForm">
                    <div style="display:flex; align-items:center; gap:1rem; margin-bottom:1rem;">
                        <div id="profileAvatarPreview" class="user-avatar" style="width:56px; height:56px; font-size:20px;">U</div>
                        <div style="display:grid; gap:0.5rem;">
                            <input type="text" id="profileName" placeholder="–ò–º—è">
                            <input type="text" id="profilePhone" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω">
                        </div>
                    </div>
                    <input type="text" id="profileAddress" placeholder="–ê–¥—Ä–µ—Å">
                    <div style="display:grid; gap:0.5rem;">
                        <input type="url" id="profileAvatarUrl" placeholder="URL –∞–≤–∞—Ç–∞—Ä–∞ (png/jpg)">
                        <input type="file" id="profileAvatarFile" accept="image/*">
                        <small>–ú–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, –±—É–¥–µ—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω –∫–∞–∫ –∞–≤–∞—Ç–∞—Ä.</small>
                    </div>
                    <div class="modal-buttons">
                        <button type="button" onclick="closeModal('profileModal')">–û—Ç–º–µ–Ω–∞</button>
                        <button type="submit">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª–∫–∞ –∫—Ä–æ–ø–ø–µ—Ä–∞ -->
    <div id="cropModal" class="modal">
        <div class="modal-content" style="max-width: 560px;">
            <div class="modal-header">
                <h3>–û–±—Ä–µ–∑–∞—Ç—å —Ñ–æ—Ç–æ</h3>
                <span class="close" onclick="closeModal('cropModal')">&times;</span>
            </div>
            <div class="modal-body" style="display:grid; gap:1rem;">
                <canvas id="cropCanvas" width="480" height="480" style="width:100%; background:#111;"></canvas>
                <small>–í—ã–¥–µ–ª–∏—Ç–µ –∫–≤–∞–¥—Ä–∞—Ç–Ω—É—é –æ–±–ª–∞—Å—Ç—å –º—ã—à—å—é. –ö–æ–ª–µ—Å–æ –º—ã—à–∏ ‚Äî –º–∞—Å—à—Ç–∞–±.</small>
                <div class="modal-buttons">
                    <button type="button" onclick="closeModal('cropModal')">–û—Ç–º–µ–Ω–∞</button>
                    <button type="button" onclick="confirmCrop()">–û–±—Ä–µ–∑–∞—Ç—å</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤–æ–¥–∏—Ç–µ–ª—è -->
    <div id="editDriverModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –≤–æ–¥–∏—Ç–µ–ª—è</h3>
                <span class="close" onclick="closeModal('editDriverModal')">&times;</span>
            </div>
            <form id="editDriverForm">
                <input type="hidden" id="editDriverId">
                <input type="text" id="editDriverName" placeholder="–§–ò–û" required>
                <input type="text" id="editDriverLicense" placeholder="–ù–æ–º–µ—Ä –ø—Ä–∞–≤" required>
                <input type="text" id="editDriverAddress" placeholder="–ê–¥—Ä–µ—Å">
                <input type="text" id="editDriverPhone" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω">
                <div class="modal-buttons">
                    <button type="button" onclick="closeModal('editDriverModal')">–û—Ç–º–µ–Ω–∞</button>
                    <button type="submit">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                </div>
            </form>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∞–≤—Ç–æ–º–æ–±–∏–ª—è -->
    <div id="editVehicleModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∞–≤—Ç–æ–º–æ–±–∏–ª—å</h3>
                <span class="close" onclick="closeModal('editVehicleModal')">&times;</span>
            </div>
            <form id="editVehicleForm">
                <input type="hidden" id="editVehicleId">
                <input type="text" id="editVehiclePlate" placeholder="–ì–æ—Å–Ω–æ–º–µ—Ä" required>
                <input type="text" id="editVehicleBrand" placeholder="–ú–∞—Ä–∫–∞" required>
                <input type="text" id="editVehicleModel" placeholder="–ú–æ–¥–µ–ª—å" required>
                <input type="number" id="editVehicleYear" placeholder="–ì–æ–¥ –≤—ã–ø—É—Å–∫–∞">
                <input type="number" id="editVehicleOwnerId" placeholder="ID –≤–ª–∞–¥–µ–ª—å—Ü–∞" required>
                <div class="modal-buttons">
                    <button type="button" onclick="closeModal('editVehicleModal')">–û—Ç–º–µ–Ω–∞</button>
                    <button type="submit">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                </div>
            </form>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞—Ä—É—à–µ–Ω–∏—è -->
    <div id="editViolationModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞—Ä—É—à–µ–Ω–∏–µ</h3>
                <span class="close" onclick="closeModal('editViolationModal')">&times;</span>
            </div>
            <form id="editViolationForm">
                <input type="hidden" id="editViolationId">
                <input type="number" id="editViolationDriverId" placeholder="ID –≤–æ–¥–∏—Ç–µ–ª—è" required>
                <input type="number" id="editViolationVehicleId" placeholder="ID –∞–≤—Ç–æ–º–æ–±–∏–ª—è" required>
                <input type="text" id="editViolationType" placeholder="–¢–∏–ø –Ω–∞—Ä—É—à–µ–Ω–∏—è" required>
                <input type="number" id="editViolationFine" placeholder="–°—É–º–º–∞ —à—Ç—Ä–∞—Ñ–∞" step="0.01" required>
                <select id="editViolationStatus">
                    <option value="–ù–µ –æ–ø–ª–∞—á–µ–Ω">–ù–µ –æ–ø–ª–∞—á–µ–Ω</option>
                    <option value="–û–ø–ª–∞—á–µ–Ω">–û–ø–ª–∞—á–µ–Ω</option>
                    <option value="–û—Ç–º–µ–Ω–µ–Ω">–û—Ç–º–µ–Ω–µ–Ω</option>
                </select>
                <div class="modal-buttons">
                    <button type="button" onclick="closeModal('editViolationModal')">–û—Ç–º–µ–Ω–∞</button>
                    <button type="submit">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                </div>
            </form>
        </div>
    </div>

    <!-- –î–∏–∞–ª–æ–≥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —É–¥–∞–ª–µ–Ω–∏—è -->
    <div id="deleteConfirmModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è</h3>
                <span class="close" onclick="closeModal('deleteConfirmModal')">&times;</span>
            </div>
            <div class="modal-body">
                <p id="deleteConfirmMessage">–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç—É –∑–∞–ø–∏—Å—å?</p>
                <div class="modal-buttons">
                    <button type="button" onclick="closeModal('deleteConfirmModal')">–û—Ç–º–µ–Ω–∞</button>
                    <button type="button" id="confirmDeleteBtn" class="btn-danger">–£–¥–∞–ª–∏—Ç—å</button>
                </div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>